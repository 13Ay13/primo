import{c as e,b as t}from"./index.js";import{a as n}from"./xml-fold.js";var o=e((function(e,n){!function(e){e.defineOption("autoCloseTags",!1,(function(t,n,r){if(r!=e.Init&&r&&t.removeKeyMap("autoCloseTags"),n){var i={name:"autoCloseTags"};"object"==typeof n&&!1===n.whenClosing||(i["'/'"]=function(e){return a(e)}),"object"==typeof n&&!1===n.whenOpening||(i["'>'"]=function(e){return o(e)}),t.addKeyMap(i)}}));var t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],n=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function o(o){if(o.getOption("disableInput"))return e.Pass;for(var r=o.listSelections(),a=[],l=o.getOption("autoCloseTags"),c=0;c<r.length;c++){if(!r[c].empty())return e.Pass;var g=r[c].head,d=o.getTokenAt(g),f=e.innerMode(o.getMode(),d.state),u=f.state,m=f.mode.xmlCurrentTag&&f.mode.xmlCurrentTag(u),h=m&&m.name;if(!h)return e.Pass;var p="html"==f.mode.configuration,b="object"==typeof l&&l.dontCloseTags||p&&t,v="object"==typeof l&&l.indentTags||p&&n;d.end>g.ch&&(h=h.slice(0,h.length-d.end+g.ch));var C=h.toLowerCase();if(!h||"string"==d.type&&(d.end!=g.ch||!/[\"\']/.test(d.string.charAt(d.string.length-1))||1==d.string.length)||"tag"==d.type&&m.close||d.string.indexOf("/")==g.ch-d.start-1||b&&i(b,C)>-1||s(o,f.mode.xmlCurrentContext&&f.mode.xmlCurrentContext(u)||[],h,g,!0))return e.Pass;var x="object"==typeof l&&l.emptyTags;if(x&&i(x,h)>-1)a[c]={text:"/>",newPos:e.Pos(g.line,g.ch+2)};else{var y=v&&i(v,C)>-1;a[c]={indent:y,text:">"+(y?"\n\n":"")+"</"+h+">",newPos:y?e.Pos(g.line+1,0):e.Pos(g.line,g.ch+1)}}}var P="object"==typeof l&&l.dontIndentOnAutoClose;for(c=r.length-1;c>=0;c--){var T=a[c];o.replaceRange(T.text,r[c].head,r[c].anchor,"+insert");var j=o.listSelections().slice(0);j[c]={head:T.newPos,anchor:T.newPos},o.setSelections(j),!P&&T.indent&&(o.indentLine(T.newPos.line,null,!0),o.indentLine(T.newPos.line+1,null,!0))}}function r(t,n){for(var o=t.listSelections(),r=[],a=n?"/":"</",i=t.getOption("autoCloseTags"),l="object"==typeof i&&i.dontIndentOnSlash,c=0;c<o.length;c++){if(!o[c].empty())return e.Pass;var g=o[c].head,d=t.getTokenAt(g),f=e.innerMode(t.getMode(),d.state),u=f.state;if(n&&("string"==d.type||"<"!=d.string.charAt(0)||d.start!=g.ch-1))return e.Pass;var m,h="xml"!=f.mode.name&&"htmlmixed"==t.getMode().name;if(h&&"javascript"==f.mode.name)m=a+"script";else if(h&&"css"==f.mode.name)m=a+"style";else{var p=f.mode.xmlCurrentContext&&f.mode.xmlCurrentContext(u),b=p.length?p[p.length-1]:"";if(!p||p.length&&s(t,p,b,g))return e.Pass;m=a+b}">"!=t.getLine(g.line).charAt(d.end)&&(m+=">"),r[c]=m}if(t.replaceSelections(r),o=t.listSelections(),!l)for(c=0;c<o.length;c++)(c==o.length-1||o[c].head.line<o[c+1].head.line)&&t.indentLine(o[c].head.line)}function a(t){return t.getOption("disableInput")?e.Pass:r(t,!0)}function i(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;++n)if(e[n]==t)return n;return-1}function s(t,n,o,r,a){if(!e.scanForClosingTag)return!1;var i=Math.min(t.lastLine()+1,r.line+500),s=e.scanForClosingTag(t,r,null,i);if(!s||s.tag!=o)return!1;for(var l=a?1:0,c=n.length-1;c>=0&&n[c]==o;c--)++l;for(r=s.to,c=1;c<l;c++){var g=e.scanForClosingTag(t,r,null,i);if(!g||g.tag!=o)return!1;r=g.to}return!0}e.commands.closeTag=function(e){return r(e)}}(t)})),r=Object.freeze(Object.assign(Object.create(null),o,{[Symbol.toStringTag]:"Module",default:o}));export{r as c};
//# sourceMappingURL=closetag.js.map
