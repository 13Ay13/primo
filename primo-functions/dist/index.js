"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=t(require("autoprefixer")),n=t(require("postcss")),s=t(require("precss")),i=t(require("tailwindcss")),r=t(require("clean-css")),c=t(require("fs")),o=t(require("prettier")),l=t(require("lodash"));async function a(t,c,o,l){let{tailwindConfig:a,includeBase:d,purge:u,includeTailwind:p}=o;try{a=a?new Function("return "+a)():{},a={...a,purge:{enabled:u,content:[{raw:c,extension:"html"}]}}}catch(t){console.error(t)}const f=i(a),m=`    ${d?"\n      @tailwind base;":""}    ${p?"\n      @tailwind components;      @tailwind utilities;    ":""}\n    \n  ${t}`;try{const t=await n([f,s,e]).process(m,{from:void 0,to:"styles.css"}).catch(t=>{console.error(t)});return t?p?new r({}).minify(t.css).styles:t.css:""}catch(t){return console.log("PostCSS error"),console.error(t),""}}var d={processPostCSS:a,buildSite:async function({pages:t,siteStyles:e}){c.mkdir("./build",{recursive:!0},t=>{if(t)throw t});const n=e.final,s=o.format(n,{parser:"css"});c.writeFile("./build/styles.css",s,t=>{if(t)throw t}),t.forEach(async t=>{const n=function({id:t,title:e,content:n,dependencies:s,styles:i}){let r="";n.forEach(t=>{r+=`<section id="section-${t.id}">\n\t<div class="columns flex flex-wrap ${"contained"===t.width?"container":""}">\n`,t.columns.forEach(t=>{r+=`\t\t<div class="column ${t.size}" id="column-${t.id}">\n`,t.rows.forEach(t=>{r+="component"===t.type?`\t\t\t<div class="primo-component">\n\t\t\t\t<div id="component-${t.id}" class="w-full">${t.value.final.html}</div>\n\t\t\t\t<script>${t.value.final.js}<\/script>\n\t\t\t</div>\n`:`\t\t\t<div class="primo-content">\n\t\t\t\t${t.value.html}\n\t\t\t</div>\n`}),r+="\t\t</div>\n"}),r+="\t</div>\n</section>\n"});return r=r.replace(/href=(['"])\/([\S]+)(\1)[^>\s]*/g,"href='/$2.html'"),`\n      <!doctype html>\n\n      <html lang="en">\n      <head>\n        <meta charset="utf-8">\n        <title>${e}</title>\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <link rel="stylesheet" type="text/css" href="./styles.css" />\n        <link rel="stylesheet" type="text/css" href="./${t}.css" />\n        <script src="./${t}.js"><\/script>\n        ${s.headEmbed}\n      </head>\n      <body data-instant-intensity="all" class="primo-page">   \n        ${r}\n        <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.js" integrity="sha256-DdSiNPR71ROAVMqT6NiHagLAtZv9EHeByYuVxygZM5g=" crossorigin="anonymous"><\/script>\n      </body>\n      </html>\n    `}(t),s=o.format(n,{parser:"html"});c.writeFile(`./build/${t.id}.html`,s,t=>{if(t)throw t});const i=await async function(t,e,n,s){const i=l.flatMapDeep(t,t=>t.columns.map(t=>t.rows.filter(t=>"component"===t.type))).map(t=>`#component-${t.id} {${t.value.raw.css}}`).join("\n"),r=n+i;return await a(r,e,{includeBase:!0,includeTailwind:!0,purge:!0,tailwindConfig:s})}(t.content,n,e.raw+t.styles.raw,e.tailwind),r=o.format(i,{parser:"css"});c.writeFile(`./build/${t.id}.css`,r,t=>{if(t)throw t})})}},u=d.processPostCSS,p=d.buildSite;exports.buildSite=p,exports.default=d,exports.processPostCSS=u;
