<script>
  import {firebase} from '@fb'
  import {firestore, collections} from './_store.js'
  import { onMount, setContext, createEventDispatcher } from 'svelte'
  import { get } from 'svelte/store'
  import { domainInfo } from '@stores/data'

  const dispatch = createEventDispatcher()

  onMount(() => {
    if ($firestore) {
      dispatch('load')
    } 
  })

  $: if ($firebase && !$firestore) {
    firestore.set($firebase.firestore())
    collections.set({
      users: $firestore.collection("users"),
      domains: $domainInfo.isSubdomain ? $firestore.collection("subdomains") : $firestore.collection("domains"),
      subdomains: $firestore.collection("subdomains") // kept so that subdomains can still be updated when 'domains' collection is active
    })
    dispatch('load')
  }

</script>
