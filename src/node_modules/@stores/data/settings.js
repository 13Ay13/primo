import { writable, readable, derived, get } from 'svelte/store';
import {updatePage} from '@fb/firestore/domains'
import { tailwindConfig } from 'const'

const store = writable({
  globalStyles: {
    uncompiled: '',
    compiled: '',
    tailwindConfig
  },
  javascript: '',
  identity : {
    title: '', 
    url: '',
    description: ''
  }
})

export default {
  save: (settings) => {
    if (typeof settings === 'function') {
      settings = settings(get(store))
      store.set(settings)
    } else if (settings) {
      store.set(settings)
    } else {
      settings = get(store)
    }
    updatePage({ settings })
  },
  update: store.update,
  set: store.set,
  subscribe: store.subscribe
}

// TODO when saving settings: 
// hydrateAllComponentHTML() // update components with new nav
// await changePageUrl(identity) // change page id in database
// Re-compile styles within components with updated global/page styles